{% load static %}
<!--
Some of the html in this file is based off of the following UNDER MIT License:
Title: Bootstrap snippet. bs4 simple social network post
Author: Bootdey.com
Link: https://www.bootdey.com/snippets/view/bs4-simple-social-network-post
Date Accessed: Feb 15, 2023
Link: https://www.bootdey.com/snippets/view/bs4-s
-->
  <div class="card container-fluid p-0 my-3">
    <div class="card-header">
      <div class="media">
        <div class="d-flex flex-row">
          <div class="m-2">
            <a class="d-flex" href="{% url 'profile' node=post.tag author_id=post.author.url|extract_uuid %}">
              {% if post.author.profileImage %}
              <img src="{{post.author.profileImage}}" class="object-fit-cover user-avatar-circle rounded-circle my-1" alt=""></img>
              {% else %}
              <i class="bi bi-person text-muted" style="font-size: 40px; text-align: center;" alt=""></i>
              {% endif %}
            </a>
          </div>
          <div class="m-2">
            <h4>
              <a class="card-title" href="{% url 'post_detail' %}?node={{post.tag}}?author={{post.author.url|extract_uuid}}?post={{post.origin|extract_uuid}}" style="text-decoration: none;">{{post.title}}</a>
            </h4>
            <span class="node-tag">{{post.tag}}</span>
          </div>

        </div>

        <a class="text-muted m-2" href="{% url 'profile' node=post.tag author_id=post.author.url|extract_uuid %}" style="text-decoration: none;">
          {{post.author.displayName}}
        </a>
        <span class="text-muted m-2" style="text-decoration: none;">
          {{post.published|readable_time}}
        </span>
      </div>
    </div>
    <div class="card-body">
      <p class="card-body">{{post.content}}</p>
    </div>
    <div class="card-footer likes-reply">

      <button id="like-post-{{post.uuid|convert_uuid_to_hex}}" class="d-inline-flex text-muted like-button" style="text-decoration: none;">
        <i class="bi bi-heart mx-1" ></i>
        <strong id="like-count-{{post.uuid|convert_uuid_to_hex}}">{{post.likeCount}}</strong>
      </button>

      {% if user %}
        <a type="button" class="d-inline-flex text-muted mx-2" data-bs-toggle="modal" data-bs-target="#new-comment-{{post.uuid|convert_uuid_to_hex}}" style="text-decoration: none;">
          <i class="bi bi-reply mx-1"></i>
          <strong>Reply</strong>
        </a>

        {% if user.username|convert_username_to_id|stringformat:"s" == post.author.id|convert_uuid_to_hex|stringformat:"s" %}
          <a type="button" class="d-inline-flex text-muted mx-2 delete-button" style="text-decoration: none;" id="delete-post-{{post.uuid|convert_uuid_to_hex}}" data-bs-toggle="modal" data-bs-target="#delete-post-modal-{{post.uuid|convert_uuid_to_hex}}">
            <i class="bi bi-trash"></i>
            <strong>Delete</strong>
          </a>
          <a type="button" class="d-inline-flex text-muted mx-2 edit-button" style="text-decoration: none;" id="edit-post-{{post.uuid|convert_uuid_to_hex}}" href="{% url 'post_edit' post_id=post.uuid|convert_uuid_to_hex %}">
            <i class="bi bi-pencil-square"></i>
            <strong>Edit</strong>
          </a>
        {% endif %}

        <!--Delete Modal -->
      <div class="modal fade" id="delete-post-modal-{{post.uuid|convert_uuid_to_hex}}" tabindex="-1" role="dialog" aria-labelledby="delete-post-modal-label-{{post.uuid|convert_uuid_to_hex}}" aria-hidden="true" data-bs-backdrop="false">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="delete-post-modal-label-{{post.uuid|convert_uuid_to_hex}}">Delete post</h5>
              <button type="button" class="close btn btn-secondary" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete this post?
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-danger" id="confirm-delete-post-{{post.uuid|convert_uuid_to_hex}}">Delete</button>
            </div>
          </div>
        </div>
      </div>


      {% endif %}

    </div>
    <div class="card-footer">
      <button class="d-inline-flex btn btn-primary" data-bs-toggle="collapse" data-bs-target="#collapse_{{post.uuid|convert_uuid_to_hex}}" role="button" aria-expanded="false" aria-controls="collapse_{{post.uuid|convert_uuid_to_hex}}">
        <span class="d-inline-flex">Comments</span>
        <i class="d-inline-flex bi bi-chat mx-1" ></i>
        <span class="d-inline-flex">{{post.count}}</span>
      </button>
    </div>

    <div id="comments-{{post.uuid}}" class="collapse" id="collapse_{{post.uuid|convert_uuid_to_hex}}">

      {% for comment in post.commentSrc.comments %}

      <div class="card-footer">
        {% include "comment.html" %}
      </div>

      {% endfor %}

    </div>
    {% if user %}
    {% include "new_comment_modal.html" %}
    {% endif %}
  </div>